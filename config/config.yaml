# Configuration for options trading strategy

# File paths
paths:
  input_file: "C:\\Users\\alexp\\OneDrive\\Gdrive\\Trading\\Data Outputs\\SPY_Combined.csv"
  output_dir: "C:\\Users\\alexp\\OneDrive\\Gdrive\\Trading\\Data Outputs\\scenario_results"
  trades_output_file: "trades.csv"
  verification_output_dir: "C:\\Users\\alexp\\OneDrive\\Gdrive\\Trading\\Data Outputs\\verification_files"

# Date range for backtesting
dates:
  start_date: "2024-01-01"
  end_date: "2024-01-10"

# Portfolio settings
portfolio:
  initial_capital: 100000
  max_leverage: 12
  max_nlv_percent: 1.0
  max_position_size_pct: 0.05  # Reduced from 0.25 to 0.05 (5% per position)
  max_portfolio_delta: 0.50    # 50% of portfolio value as max delta exposure

# Hedging configuration (moved from strategy section)
hedging:
  enabled: true
  mode: "ratio"
  hedge_with_underlying: true  # Use underlying price from option data for hedging
  target_delta_ratio: 0.05     # Reduced from 0.1 to 0.05 (5% of NLV)
  delta_tolerance: 0.1        # Reduced from 0.3 to 0.1 (10% of NLV)
  hedge_symbol: "SPY"
  max_hedge_ratio: 1.5  # Reduced from 3.0 to 1.5

# Risk management settings
risk:
  rolling_window: 21
  target_z: 0
  min_z: -2.0
  min_investment: 0.25
  short_window: 21
  medium_window: 63
  long_window: 252  # Changed to 252 trading days (1 year)
  # Which window to use for risk scaling (short, medium, long)
  risk_scaling_window: "short"

# Strategy parameters
strategy:
  name: "ThetaDecayStrategy"
  # Option selection parameters
  days_to_expiry_min: 60
  days_to_expiry_max: 90
  is_short: true
  delta_target: -0.2
  delta_tolerance: 0.01  # Added tolerance parameter
  profit_target: 0.65
  stop_loss_threshold: 2.5
  close_days_to_expiry: 14
  min_position_size: 1

# Trading parameters
trading:
  normal_spread: 0.60

# Margin management parameters
margin_management:
  # New margin threshold settings
  high_margin_threshold: 0.98   # Increased from 0.90 to 0.98 (98% margin usage)
  target_margin_threshold: 0.95 # Increased from 0.80 to 0.95 (95% margin usage)
  
  # Margin calculation method
  margin_calculation_method: "portfolio"  # Options: "simple" or "portfolio"
  use_portfolio_calculator: true  # Whether to use the portfolio's margin calculator
  
  # Buffer and cooldown settings
  margin_buffer_pct: 0.10
  rebalance_cooldown_days: 3
  
  # Position reduction parameters
  max_position_reduction_pct: 0.25      # Standard max reduction per position (25%)
  losing_position_max_reduction_pct: 0.40 # Higher reduction for losing positions (40%)
  urgent_reduction_pct: 0.50            # Up to 50% in urgent situations

# Reporting parameters
reporting:
  # Enable business logic verification file output
  generate_verification_files: true
  # Enable detailed logging for verification files
  detailed_verification_logging: true
  # Format settings for verification files
  verification_file_format:
    include_trade_manager_logs: true
    include_risk_scaling_logs: true
    include_portfolio_logs: true